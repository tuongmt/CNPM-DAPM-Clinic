<!-- Thêm thư viện & thay đổi mô hình để sử dụng thư viện phân trang -->
@using PagedList.Mvc;
@model PagedList.IPagedList<DoAn_CNPM.Models.DetailForm>
@*@model IEnumerable<DoAn_CNPM.Models.DetailForm>*@

@{
    ViewBag.Title = "THÔNG TIN CHI TIẾT ĐƠN KHÁM";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="f-index">
    <div class="tabular--wrapper">
        <a href="./Index">  <h2 class="h2--title">@ViewData["Title"]</h2></a>
        <hr />
        @using (Html.BeginForm("Index", "DetailForms", FormMethod.Get))
        {
            <div class="nav--search d_flex">
                <div style="text-align:center; margin:3px 0px">
                    <a href="@Url.Action("Create")" class="btn btn-createnew"><i class="fa-solid fa-plus"></i></a>
                </div>
                <div class="search--box">
                    <input type="text" name="searchString" placeholder="Nhập thông tin tìm kiếm" />
                    <button type="submit" value="Tìm kiếm"><i class="fa-solid fa-magnifying-glass"></i></button>
                </div>
            </div>
        }
        <div class="table-container">
            <table class="table table-hover table-striped table-bordered">
                <tr style="">
                    <th>
                        Id CTĐK
                    </th>
                    <th>
                        Id Đơn khám
                    </th>
                    @*<th style=" background: rgb(63,154,129); color: #fff;">
                            Tên bảng giá khám
                        </th>
                         <th>
                            SL
                        </th>
                         <th>
                            Đơn giá
                        </th>*@
                    <th>
                        Tổng tiền
                    </th>
                    <th>
                        Trạng thái khám
                    </th>
                    <th>
                        Thao tác khám
                    </th>
                    <th>
                        Trạng thái thanh toán
                    </th>
                    <th>
                        Thao tác thanh toán
                    </th>
                    <th>Thao tác Sửa - Xóa </th>
                </tr>

                @foreach (var item in Model)
                {
                    decimal total = Convert.ToDecimal(item.Quantity * item.PriceList.Price);
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.DFId)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.FormId)
                        </td>
                        @* <td>
                                 @Html.DisplayFor(modelItem => item.PriceList.NamePriceList)
                             </td>
                            <td>
                                 @Html.DisplayFor(modelItem => item.Quantity)
                             </td>
                             <td>
                                 @{
                                     string formattedPrice = string.Format("{0:#,##0}", item.PriceList.Price);
                                     formattedPrice = formattedPrice.Replace(",", ".");
                                 }

                                 @Html.DisplayFor(modelItem => formattedPrice) VNĐ
                             </td>*@
                        <td class="price">
                            @{
                                string formattedTotal = string.Format("{0:#,##0}", item.TotalMoney);
                                formattedTotal = formattedTotal.Replace(",", ".");
                            }

                            @Html.DisplayFor(modelItem => formattedTotal) VNĐ
                        </td>
                        <td>
                            @if (item.IsExamined == true)
                            {
                                <span class="check-true">Đã khám</span>
                            }
                            else
                            {
                                <span class="check-false">Chưa khám</span>
                            }
                        </td>
                        <td style="color:white">
                            @using (Html.BeginForm("UpdateExaminedStatus", "DetailForms", new { id = item.DFId }, FormMethod.Post))
                            {
                                <input type="submit" value="Xác nhận" class="btn btn-outline-success" />
                            }

                        </td>
                        <td>
                            @if (item.IsPaid == true)
                            {
                                <span class="check-true">Đã thanh toán</span>
                            }
                            else
                            {
                                <span class="check-false">Chưa thanh toán</span>
                            }

                        </td>
                        <td style="color:white">
                            @using (Html.BeginForm("UpdatePaymentStatus", "DetailForms", new { id = item.DFId }, FormMethod.Post))
                            {
                                <input type="submit" value="Thanh toán" class="btn btn-outline-success" />
                            }

                        </td>
                        <td>
                            <a href="@Url.Action("Details", new { id = item.DFId })" class="btn btn-details"><i class="fa-solid fa-eye"></i></a>
                            <a href="@Url.Action("Edit", new { id = item.DFId })" class="btn btn-edit"><i class="fa-regular fa-pen-to-square"></i></a>
                            <a href="@Url.Action("Delete", new { id = item.DFId })" class="btn btn-del"><i class="fa-regular fa-trash-can"></i></a>
                        </td>
                    </tr>
                }

            </table>
        </div>
    </div>
</div>
<div class="page">
    <!-- Thêm đoạn mã để hiển thị số trang và số trang hiện tại -->
    <span>
        Trang @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) / @Model.PageCount
    </span>
    <!--Control PagedListPager: mô tả mô hình với số trang là liên kết với tham số "Index" và tham
    số page-->
    @Html.PagedListPager(Model, page => Url.Action("Index", new { page }))

</div>
